{
  "$schema": "http://json-schema.org/draft-07/schema",
  "type": "object",
  "properties": {
    "MedicalLicense": {
      "$ref": "#/definitions/MedicalLicense"
    }
  },
  "required": ["MedicalLicense"],
  "title": "MedicalLicense",
  "definitions": {
    "MedicalLicense": {
      "$id": "#/properties/MedicalLicense",
      "type": "object",
      "title": "Medical License Schema",
      "description": "Egyptian Medical Practice License",
      "required": [
        "licenseNumber",
        "licenseType",
        "holderName",
        "holderNationalId",
        "issuingAuthority",
        "issueDate",
        "expiryDate"
      ],
      "properties": {
        "licenseNumber": {
          "type": "string",
          "title": "License Number"
        },
        "licenseType": {
          "type": "string",
          "title": "License Type",
          "enum": [
            "Medical Practice License",
            "Specialist License",
            "Consultant License",
            "Temporary Practice License",
            "Training License",
            "Research License",
            "Pharmacy License",
            "Nursing License",
            "Allied Health License",
            "Facility License"
          ]
        },
        "holderName": {
          "type": "string",
          "title": "License Holder Name"
        },
        "holderNameArabic": {
          "type": "string",
          "title": "License Holder Name (Arabic)"
        },
        "holderNationalId": {
          "type": "string",
          "title": "Holder National ID",
          "pattern": "^[0-9]{14}$"
        },
        "holderSyndicateNumber": {
          "type": "string",
          "title": "Holder Syndicate Number"
        },
        "profession": {
          "type": "string",
          "title": "Profession",
          "enum": [
            "Doctor",
            "Dentist",
            "Pharmacist",
            "Nurse",
            "Physiotherapist",
            "Laboratory Technician",
            "Radiologist Technician",
            "Optometrist",
            "Midwife",
            "Paramedic",
            "Other"
          ]
        },
        "specialization": {
          "type": "string",
          "title": "Specialization"
        },
        "issuingAuthority": {
          "type": "string",
          "title": "Issuing Authority",
          "enum": [
            "Ministry of Health",
            "Medical Syndicate",
            "Pharmacy Syndicate",
            "Nursing Syndicate",
            "Health Insurance Organization",
            "University Hospital",
            "Other"
          ]
        },
        "issuingGovernorate": {
          "type": "string",
          "title": "Issuing Governorate"
        },
        "issueDate": {
          "type": "string",
          "format": "date",
          "title": "Issue Date"
        },
        "expiryDate": {
          "type": "string",
          "format": "date",
          "title": "Expiry Date"
        },
        "renewalDate": {
          "type": "string",
          "format": "date",
          "title": "Last Renewal Date"
        },
        "practiceScope": {
          "type": "array",
          "title": "Practice Scope",
          "items": {"type": "string"}
        },
        "restrictions": {
          "type": "array",
          "title": "Restrictions",
          "items": {"type": "string"}
        },
        "practiceLocation": {
          "type": "object",
          "title": "Authorized Practice Location",
          "properties": {
            "facilityName": {"type": "string"},
            "facilityLicenseNumber": {"type": "string"},
            "address": {"type": "string"},
            "governorate": {"type": "string"}
          }
        },
        "verificationCode": {
          "type": "string",
          "title": "Verification Code"
        },
        "qrCode": {
          "type": "string",
          "title": "QR Code URL"
        },
        "status": {
          "type": "string",
          "title": "License Status",
          "enum": ["Active", "Expired", "Suspended", "Revoked", "Pending Renewal"],
          "default": "Active"
        },
        "suspensionReason": {
          "type": "string",
          "title": "Suspension/Revocation Reason"
        },
        "suspensionDate": {
          "type": "string",
          "format": "date",
          "title": "Suspension Date"
        },
        "notes": {
          "type": "string",
          "title": "Additional Notes"
        }
      }
    }
  },
  "_osConfig": {
    "privateFields": ["holderNationalId"],
    "signedFields": ["licenseNumber", "holderName", "licenseType", "issuingAuthority", "issueDate", "expiryDate"],
    "indexFields": ["licenseNumber", "holderNationalId", "holderSyndicateNumber", "licenseType", "status", "profession"],
    "uniqueIndexFields": ["licenseNumber", "verificationCode"],
    "systemFields": ["osCreatedAt", "osUpdatedAt", "osCreatedBy", "osUpdatedBy"],
    "roles": ["Admin", "Doctor", "Nurse", "Pharmacist"],
    "inviteRoles": ["Admin"],
    "ownershipAttributes": [
      {
        "userId": "/osOwner"
      }
    ],
    "attestationPolicies": [
      {
        "name": "licenseVerification",
        "conditions": "(ATTESTOR#$.licenseNumber#.contains(REQUESTER#$.licenseNumber#))",
        "type": "MANUAL",
        "attestorPlugin": "did:internal:ClaimPluginActor?entity=Admin"
      }
    ],
    "credentialTemplate": {
      "@context": [
        "https://www.w3.org/2018/credentials/v1",
        "https://healthflow.eg/credentials/v1"
      ],
      "type": ["VerifiableCredential", "MedicalLicenseCredential"],
      "issuer": "did:healthflow:registry",
      "issuanceDate": "{{osCreatedAt}}",
      "expirationDate": "{{expiryDate}}",
      "credentialSubject": {
        "type": "MedicalLicense",
        "id": "did:healthflow:license:{{licenseNumber}}",
        "licenseNumber": "{{licenseNumber}}",
        "holderName": "{{holderName}}",
        "licenseType": "{{licenseType}}",
        "profession": "{{profession}}",
        "specialization": "{{specialization}}",
        "issuingAuthority": "{{issuingAuthority}}",
        "issueDate": "{{issueDate}}",
        "expiryDate": "{{expiryDate}}"
      }
    }
  }
}
