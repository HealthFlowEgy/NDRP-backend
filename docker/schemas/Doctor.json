{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Doctor",
  "type": "object",
  "description": "Healthcare Provider - Doctor Registry for Egyptian Medical Syndicate",
  "definitions": {
    "Address": {
      "type": "object",
      "properties": {
        "streetAddress": { "type": "string" },
        "streetAddress2": { "type": "string" },
        "city": { "type": "string" },
        "governorate": {
          "type": "string",
          "enum": [
            "Cairo", "Giza", "Alexandria", "Dakahlia", "Sharqia",
            "Qalyubia", "Beheira", "Kafr El Sheikh", "Gharbia", "Monufia",
            "Damietta", "Port Said", "Ismailia", "Suez", "North Sinai",
            "South Sinai", "Red Sea", "Fayoum", "Beni Suef", "Minya",
            "Asyut", "Sohag", "Qena", "Aswan", "Luxor", "Matrouh", "New Valley"
          ]
        },
        "postalCode": { "type": "string" },
        "country": { "type": "string", "default": "Egypt" }
      },
      "required": ["city", "governorate"]
    }
  },
  "properties": {
    "nationalId": {
      "type": "string",
      "title": "National ID Number",
      "pattern": "^[0-9]{14}$",
      "description": "14-digit Egyptian National ID"
    },
    "emsRegistrationNumber": {
      "type": "string",
      "title": "EMS Registration Number",
      "description": "Egyptian Medical Syndicate registration number"
    },
    "healthflowId": {
      "type": "string",
      "title": "HealthFlow ID",
      "description": "System-generated unique identifier (EG-DR-YYYY-NNNNNN)"
    },
    "titlePrefix": {
      "type": "string",
      "enum": ["Dr.", "Prof. Dr.", "Assoc. Prof. Dr."],
      "title": "Title"
    },
    "firstNameAr": {
      "type": "string",
      "title": "First Name (Arabic)"
    },
    "middleNameAr": {
      "type": "string",
      "title": "Middle Name (Arabic)"
    },
    "lastNameAr": {
      "type": "string",
      "title": "Last Name (Arabic)"
    },
    "firstNameEn": {
      "type": "string",
      "title": "First Name (English)"
    },
    "middleNameEn": {
      "type": "string",
      "title": "Middle Name (English)"
    },
    "lastNameEn": {
      "type": "string",
      "title": "Last Name (English)"
    },
    "gender": {
      "type": "string",
      "enum": ["male", "female"]
    },
    "dateOfBirth": {
      "type": "string",
      "format": "date"
    },
    "nationality": {
      "type": "string",
      "default": "Egyptian"
    },
    "mobileNumber": {
      "type": "string",
      "pattern": "^\\+20[0-9]{10}$",
      "description": "Egyptian mobile number in E.164 format"
    },
    "email": {
      "type": "string",
      "format": "email"
    },
    "primarySpecialty": {
      "type": "string",
      "title": "Primary Specialty",
      "enum": [
        "General Practice",
        "Internal Medicine",
        "Cardiology",
        "Dermatology",
        "Endocrinology",
        "Gastroenterology",
        "Geriatrics",
        "Hematology",
        "Infectious Diseases",
        "Nephrology",
        "Neurology",
        "Oncology",
        "Pulmonology",
        "Rheumatology",
        "General Surgery",
        "Cardiothoracic Surgery",
        "Neurosurgery",
        "Orthopedic Surgery",
        "Plastic Surgery",
        "Urology",
        "Vascular Surgery",
        "Anesthesiology",
        "Emergency Medicine",
        "Family Medicine",
        "Obstetrics & Gynecology",
        "Pediatrics",
        "Psychiatry",
        "Radiology",
        "Pathology",
        "Ophthalmology",
        "ENT (Otolaryngology)",
        "Physical Medicine & Rehabilitation"
      ]
    },
    "subSpecialties": {
      "type": "array",
      "items": { "type": "string" },
      "title": "Sub-Specialties"
    },
    "qualifications": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "degree": {
            "type": "string",
            "enum": ["MBBCh", "MD", "MS", "PhD", "MRCP", "FRCS", "Board Certification", "Fellowship", "Diploma"]
          },
          "field": { "type": "string" },
          "institution": { "type": "string" },
          "country": { "type": "string" },
          "yearObtained": { "type": "integer" },
          "certificateNumber": { "type": "string" }
        },
        "required": ["degree", "institution", "yearObtained"]
      }
    },
    "currentWorkplace": {
      "type": "object",
      "properties": {
        "facilityName": { "type": "string" },
        "facilityId": { "type": "string" },
        "facilityType": {
          "type": "string",
          "enum": ["Government Hospital", "Private Hospital", "University Hospital", "Clinic", "Health Center", "Military Hospital"]
        },
        "position": { "type": "string" },
        "department": { "type": "string" },
        "startDate": { "type": "string", "format": "date" }
      }
    },
    "practiceAddresses": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "address": { "$ref": "#/definitions/Address" },
          "facilityName": { "type": "string" },
          "practiceType": {
            "type": "string",
            "enum": ["Primary", "Secondary", "Visiting"]
          },
          "workingHours": { "type": "string" },
          "contactNumber": { "type": "string" }
        }
      }
    },
    "licenseStatus": {
      "type": "string",
      "enum": ["active", "suspended", "revoked", "expired", "pending"],
      "default": "pending"
    },
    "licenseValidFrom": {
      "type": "string",
      "format": "date"
    },
    "licenseValidUntil": {
      "type": "string",
      "format": "date"
    },
    "registrationDate": {
      "type": "string",
      "format": "date"
    },
    "lastRenewalDate": {
      "type": "string",
      "format": "date"
    },
    "uhiaRegistration": {
      "type": "object",
      "title": "UHIA Registration",
      "description": "Universal Health Insurance Authority registration",
      "properties": {
        "registrationNumber": { "type": "string" },
        "registrationDate": { "type": "string", "format": "date" },
        "status": {
          "type": "string",
          "enum": ["active", "pending", "inactive"]
        }
      }
    },
    "hcxIdentifier": {
      "type": "string",
      "title": "HCX Provider ID",
      "description": "HealthFlow Claims Exchange provider identifier"
    },
    "digitalSignature": {
      "type": "object",
      "properties": {
        "publicKeyId": { "type": "string" },
        "algorithm": { "type": "string" },
        "issueDate": { "type": "string", "format": "date-time" }
      }
    }
  },
  "required": [
    "nationalId",
    "firstNameAr",
    "lastNameAr",
    "firstNameEn",
    "lastNameEn",
    "gender",
    "dateOfBirth",
    "mobileNumber",
    "primarySpecialty"
  ],
  "_osConfig": {
    "osComment": ["qualifications", "currentWorkplace"],
    "privateFields": ["nationalId", "dateOfBirth", "mobileNumber", "email"],
    "signedFields": [],
    "indexFields": ["emsRegistrationNumber", "healthflowId", "nationalId", "primarySpecialty", "licenseStatus"],
    "uniqueIndexFields": ["emsRegistrationNumber", "nationalId", "healthflowId"],
    "systemFields": ["osCreatedAt", "osUpdatedAt", "osCreatedBy", "osUpdatedBy"],
    "inviteRoles": ["doctor"],
    "ownershipAttributes": [
      {
        "email": "/email",
        "mobile": "/mobileNumber",
        "userId": "/healthflowId"
      }
    ],
    "attestationPolicies": [
      {
        "name": "emsVerification",
        "conditions": "(ATTESTOR#$.roles contains 'ems_verifier')",
        "type": "MANUAL",
        "attestorPlugin": "did:internal:ClaimPluginActor?entity=EMS_Verifier",
        "attestationProperties": {
          "emsRegistrationNumber": "$.emsRegistrationNumber",
          "licenseStatus": "$.licenseStatus"
        }
      },
      {
        "name": "qualificationVerification",
        "conditions": "(ATTESTOR#$.roles contains 'qualification_verifier')",
        "type": "MANUAL",
        "attestorPlugin": "did:internal:ClaimPluginActor?entity=Qualification_Verifier",
        "attestationProperties": {
          "qualifications": "$.qualifications"
        }
      }
    ],
    "credentialTemplate": {
      "@context": [
        "https://www.w3.org/2018/credentials/v1",
        "https://healthflow.eg/credentials/v1"
      ],
      "type": ["VerifiableCredential", "DoctorLicenseCredential"],
      "credentialSubject": {
        "type": "Doctor",
        "id": "did:healthflow:{{healthflowId}}",
        "name": "{{titlePrefix}} {{firstNameEn}} {{middleNameEn}} {{lastNameEn}}",
        "nameAr": "{{titlePrefix}} {{firstNameAr}} {{middleNameAr}} {{lastNameAr}}",
        "emsRegistrationNumber": "{{emsRegistrationNumber}}",
        "specialty": "{{primarySpecialty}}",
        "licenseStatus": "{{licenseStatus}}",
        "validFrom": "{{licenseValidFrom}}",
        "validUntil": "{{licenseValidUntil}}"
      },
      "issuer": "did:healthflow:EgyptianMedicalSyndicate",
      "issuanceDate": "{{osCreatedAt}}"
    },
    "certificateTemplates": {
      "html": "doctor-license-template.html",
      "svg": "doctor-license-template.svg"
    },
    "enableLogin": true,
    "enableSearch": true,
    "subjectType": "healthcare_professional"
  }
}
